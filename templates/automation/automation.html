{% extends "base.html" %}

{% block title %}Automatizácie - {{ project.name }}{% endblock %}

{% block content %}
<div class="mb-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
            <li class="breadcrumb-item active">Automatizácie - {{ project.name }}</li>
        </ol>
    </nav>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0"><i class="fas fa-plus"></i> Pridať automatizáciu</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    {{ form.hidden_tag() }}

                    <div class="mb-3">
                        {{ form.script_name.label(class="form-label") }}
                        {{ form.script_name(class="form-control", placeholder="example_script.py") }}
                    </div>

                    <div class="mb-3">
                        {{ form.schedule.label(class="form-label") }}
                        {{ form.schedule(class="form-control", placeholder="0 3 * * *") }}
                        <small class="text-muted">
                            Príklady:<br>
                            <code>0 3 * * *</code> - Každý deň o 3:00<br>
                            <code>*/15 * * * *</code> - Každých 15 minút<br>
                            <code>0 */6 * * *</code> - Každých 6 hodín
                        </small>
                    </div>

                    {{ form.submit(class="btn btn-warning") }}
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="fas fa-robot"></i> Aktívne automatizácie</h5>
            </div>
            <div class="card-body">
                {% if automations %}
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Skript</th>
                                <th>Rozvrh</th>
                                <th>Stav</th>
                                <th>Posledný beh</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for auto in automations %}
                            <tr>
                                <td><code>{{ auto.script_name }}</code></td>
                                <td><code>{{ auto.schedule }}</code></td>
                                <td>
                                    {% if auto.is_active %}
                                        <span class="badge bg-success">Aktívna</span>
                                    {% else %}
                                        <span class="badge bg-danger">Neaktívna</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if auto.last_run %}
                                        {{ auto.last_run.strftime('%d.%m.%Y %H:%M') }}
                                    {% else %}
                                        <em>Ešte nebežalo</em>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted text-center">Zatiaľ žiadne automatizácie.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
